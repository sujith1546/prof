<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9fafb;
  }

  /* Header */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 18px 40px;
    background-color: #ffffff;
    border-bottom: 1px solid #e0e0e0;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .welcome-section {
    display: flex;
    flex-direction: column;
  }

  .welcome {
    font-size: 22px;
    font-weight: 600;
    color: #111827;
    margin: 0;
  }

  .tagline {
    font-size: 14px;
    color: #6b7280;
    margin-top: 2px;
    font-weight: 400;
  }

  .menu-buttons {
    display: flex;
    gap: 12px;
  }

  .menu-btn {
    padding: 8px 18px;
    background-color: #f3f4f6;
    color: #374151;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
    font-size: 14px;
  }

  .menu-btn.active, .menu-btn:hover {
    background-color: #2563eb;
    color: #ffffff;
  }

  .logout-btn {
    padding: 8px 18px;
    background-color: #ef4444;
    color: #ffffff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    transition: background-color 0.2s;
  }

  .logout-btn:hover {
    background-color: #b91c1c;
  }

  /* Content Area */
  #contentArea {
    padding: 30px;
    max-width: 1400px;
    margin: auto;
  }

  /* Logout overlay */
  .logout-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }

  .logout-overlay.show {
    opacity: 1;
    pointer-events: all;
  }

  .logout-message {
    font-size: 22px;
    font-weight: 600;
    color: #111827;
    margin-bottom: 8px;
  }

  .logout-sub {
    font-size: 16px;
    color: #6b7280;
  }

  @media(max-width: 640px) {
    .header { flex-direction: column; align-items: flex-start; gap: 12px; padding: 15px 20px; }
    .menu-buttons { flex-wrap: wrap; gap: 10px; width: 100%; }
    .menu-btn, .logout-btn { flex: 1; text-align: center; }
    #contentArea { padding: 20px; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="welcome-section">
    <div class="welcome" id="welcomeMessage">Welcome, User</div>
    <div class="tagline">Give. Feed. Hope.</div>
  </div>

  <div class="menu-buttons">
    <button class="menu-btn active" data-page="profilepage.html">Profile & Registration</button>
    <button class="menu-btn" data-page="sharefood.html">Share Food</button>
    <button class="menu-btn" data-page="dashboardpage.html">Dashboard</button>
  </div>

  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<!-- Dynamic Content Area -->
<div id="contentArea">
  <p>Loading...</p>
</div>

<!-- Logout overlay -->
<div class="logout-overlay" id="logoutOverlay">
  <div class="logout-message" id="logoutMessage"></div>
  <div class="logout-sub">Redirecting to home...</div>
</div>

<script>
  // User data storage (using in-memory storage instead of localStorage)
  let currentUser = { name: 'John Doe', type: 'restaurant' };
  
  // Global app data store
  window.appData = {
    userData: {
      name: 'Happy Bites',
      type: 'Vegetarian',
      email: 'contact@happybites.com',
      phone: '+91 9876543210',
      address: '123, Main Street, City',
      donationStatus: 'Available',
      foodPosts: []
    }
  };

  const welcomeMessage = document.getElementById('welcomeMessage');
  const logoutBtn = document.getElementById('logoutBtn');
  const logoutOverlay = document.getElementById('logoutOverlay');
  const logoutMessage = document.getElementById('logoutMessage');
  const menuButtons = document.querySelectorAll('.menu-btn');
  const contentArea = document.getElementById('contentArea');

  welcomeMessage.textContent = `Welcome ${currentUser.name}, ${capitalize(currentUser.type)}`;

  function capitalize(str) { return str.charAt(0).toUpperCase() + str.slice(1); }

  // Enhanced script execution for dynamically loaded content
  function executeScripts(container) {
    const scripts = container.querySelectorAll('script');
    scripts.forEach(oldScript => {
      const newScript = document.createElement('script');
      
      // Copy all attributes
      Array.from(oldScript.attributes).forEach(attr => {
        newScript.setAttribute(attr.name, attr.value);
      });
      
      // Handle both external and inline scripts
      if (oldScript.src) {
        newScript.src = oldScript.src;
        newScript.onload = () => {
          // Call initialization functions if they exist
          if (typeof window.initProfilePage === 'function') {
            window.initProfilePage();
          }
          if (typeof window.initShareFood === 'function') {
            window.initShareFood();
          }
        };
      } else {
        newScript.textContent = oldScript.textContent;
        // Execute inline script immediately
        setTimeout(() => {
          try {
            if (newScript.textContent.includes('initProfilePage') || 
                newScript.textContent.includes('initShareFood')) {
              eval(newScript.textContent);
            }
          } catch (e) {
            console.warn('Script execution warning:', e);
          }
        }, 0);
      }
      
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
  }

  // Load page content dynamically
  function loadPageContent(page) {
    fetch(page)
      .then(res => {
        if (!res.ok) {
          throw new Error('Page not found');
        }
        return res.text();
      })
      .then(data => {
        contentArea.innerHTML = data;
        executeScripts(contentArea);
      })
      .catch(err => {
        console.error('Error loading page:', err);
        contentArea.innerHTML = '<p>Error loading content. Please make sure the file exists in the same directory.</p>';
      });
  }

  // Menu button click
  menuButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      menuButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const page = btn.getAttribute('data-page');
      if(page) loadPageContent(page);
    });
  });

  // Load default page
  loadPageContent("profilepage.html");

  // Logout
  logoutBtn.addEventListener('click', () => {
    logoutMessage.textContent = `Thank you, ${currentUser.name} (${capitalize(currentUser.type)})`;
    logoutOverlay.classList.add('show');
    setTimeout(() => {
      window.location.href = 'index.html';
    }, 2500);
  });
</script>

</body>
</html>
